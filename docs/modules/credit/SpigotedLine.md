# Solidity API

## SpigotedLine

### spigot

```solidity
contract ISpigot spigot
```

### swapTarget

```solidity
address payable swapTarget
```

### defaultRevenueSplit

```solidity
uint8 defaultRevenueSplit
```

### unusedTokens

```solidity
mapping(address => uint256) unusedTokens
```

### constructor

```solidity
constructor(address oracle_, address arbiter_, address borrower_, address spigot_, address payable swapTarget_, uint256 ttl_, uint8 defaultRevenueSplit_) public
```

- LineofCredit contract with additional functionality for integrating with Spigot and borrower revenue streams to repay lines

| Name | Type | Description |
| ---- | ---- | ----------- |
| oracle_ | address | - price oracle to use for getting all token values |
| arbiter_ | address | - neutral party with some special priviliges on behalf of borrower and lender |
| borrower_ | address | - the debitor for all credit positions in this contract |
| spigot_ | address |  |
| swapTarget_ | address payable | - 0x protocol exchange address to send calldata for trades to |
| ttl_ | uint256 | - the debitor for all credit positions in this contract |
| defaultRevenueSplit_ | uint8 | - the debitor for all credit positions in this contract |

### _init

```solidity
function _init() internal virtual returns (enum LineLib.STATUS)
```

### unused

```solidity
function unused(address token) external view returns (uint256)
```

### _canDeclareInsolvent

```solidity
function _canDeclareInsolvent() internal virtual returns (bool)
```

### claimAndRepay

```solidity
function claimAndRepay(address claimToken, bytes zeroExTradeData) external returns (uint256)
```

- Claims revenue tokens from Spigot attached to borrowers revenue generating tokens
               and sells them via 0x protocol to repay credits
see _repay() for more details

_- callable `arbiter` + `borrower`
               bc they are most incentivized to get best price on assets being sold._

| Name | Type | Description |
| ---- | ---- | ----------- |
| claimToken | address | - The revenue token escrowed by Spigot to claim and use to repay credit |
| zeroExTradeData | bytes | - data generated by 0x API to trade `claimToken` against their exchange contract |

### useAndRepay

```solidity
function useAndRepay(uint256 amount) external returns (bool)
```

### claimAndTrade

```solidity
function claimAndTrade(address claimToken, bytes zeroExTradeData) external returns (uint256)
```

allows tokens in escrow to be sold immediately but used to pay down credit later

_ensures first token in repayment queue is being bought
   - callable `arbiter` + `borrower`_

| Name | Type | Description |
| ---- | ---- | ----------- |
| claimToken | address | - the token escrowed in spigot to sell in trade |
| zeroExTradeData | bytes | - 0x API data to use in trade to sell `claimToken` for `credits[ids[0]]` returns - amount of credit tokens bought |

### _claimAndTrade

```solidity
function _claimAndTrade(address claimToken, address targetToken, bytes zeroExTradeData) internal returns (uint256)
```

allows tokens in escrow to be sold immediately but used to pay down credit later

_MUST trade all available claim tokens to target
   priviliged internal function_

| Name | Type | Description |
| ---- | ---- | ----------- |
| claimToken | address | - the token escrowed in spigot to sell in trade |
| targetToken | address | - the token borrow owed debt in and needs to buy. Always `credits[ids[0]].token` |
| zeroExTradeData | bytes | - 0x API data to use in trade to sell `claimToken` for target returns - amount of target tokens bought |

### updateOwnerSplit

```solidity
function updateOwnerSplit(address revenueContract) external returns (bool)
```

changes the revenue split between borrower treasury and lan repayment based on line health

_- callable `arbiter` + `borrower`_

| Name | Type | Description |
| ---- | ---- | ----------- |
| revenueContract | address | - spigot to update |

| Name | Type | Description |
| ---- | ---- | ----------- |
| [0] | bool | whether or not split was updated |

### addSpigot

```solidity
function addSpigot(address revenueContract, struct ISpigot.Setting setting) external returns (bool)
```

- allow Line to add new revenue streams to reapy credit

_- see Spigot.addSpigot()
   - callable `arbiter` + `borrower`_

### updateWhitelist

```solidity
function updateWhitelist(bytes4 func, bool allowed) external returns (bool)
```

- allow borrower to call functions on their protocol to maintain it and keep earning revenue

_- see Spigot.updateWhitelistedFunction()
   - callable `arbiter`_

### releaseSpigot

```solidity
function releaseSpigot() external returns (bool)
```

-  transfers revenue streams to borrower if repaid or arbiter if liquidatable
             -  doesnt transfer out if line is unpaid and/or healthy

_- callable by anyone_

| Name | Type | Description |
| ---- | ---- | ----------- |
| [0] | bool | - whether or not spigot was released |

### sweep

```solidity
function sweep(address to, address token) external returns (uint256)
```

- sends unused tokens to borrower if repaid or arbiter if liquidatable
             -  doesnt send tokens out if line is unpaid but healthy

_- callable by anyone_

| Name | Type | Description |
| ---- | ---- | ----------- |
| to | address |  |
| token | address | - token to take out |

### receive

```solidity
receive() external payable
```

